这个错误是因为你在使用Google GenAI库时，`contents`和`config`参数的格式不正确。让我帮你修正代码：

## **问题分析**

1. `contents` 参数格式错误
2. `config` 参数中包含了不被支持的字段
3. 混合了不同API风格的参数格式

## **正确的实现方式**

### **方法1: 简化版本（推荐）**

```python
import google.generativeai as genai

# 配置API
genai.configure(api_key="your_api_key")

# 创建模型
model = genai.GenerativeModel('gemini-2.0-flash')

# 准备内容
prompt = """
Analyze this industrial operation video. Please identify and describe:

1. Detailed operation steps (in chronological order)
   - Include precise timestamps for each step
   - Describe hand movements and tool usage

2. Key quality inspection points and inspection methods
   - Visual inspection requirements
   - Measurement procedures

3. Safety precautions
   - PPE requirements
   - Hazard identification

4. Tool and material use
   - Required tools list
   - Material handling procedures

5. Potential risk points
   - Safety hazards
   - Quality risks

6. Operation standards and requirements
   - Time standards
   - Quality standards

Output format: structured JSON with clearly marked timestamps (MM:SS format)
"""

# 生成内容
try:
    response = model.generate_content([myfile, prompt])
    print(response.text)
except Exception as e:
    print(f"Error: {e}")
```

### **方法2: 使用Google GenAI客户端（修正版）**

```python
import google.genai as genai

# 创建客户端
client = genai.Client(api_key="your_api_key")

# 准备内容 - 正确的格式
contents = [
    myfile,  # 视频文件
    "Analyze this industrial operation video. Please identify and describe: 1. Detailed operation steps (in chronological order). 2. Key quality inspection points and inspection methods. 3. Safety precautions. 4. Tool and material use. 5. Potential risk points. 6. Operation standards and requirements. Output format: structured JSON, timestamp must be clearly marked"
]

# 配置参数 - 移除不支持的字段
config = {
    "temperature": 0.1,
    "max_output_tokens": 8192,
    "response_mime_type": "application/json"
}

try:
    response = client.models.generate_content(
        model="gemini-2.0-flash",
        contents=contents,
        config=config
    )
    print(response.text)
except Exception as e:
    print(f"Error: {e}")
```

### **方法3: 完整的封装类**

```python
import google.genai as genai
import json
from typing import Dict, Any, Optional

class GeminiVideoAnalyzer:
    def __init__(self, api_key: str):
        self.client = genai.Client(api_key=api_key)
        self.model = "gemini-2.0-flash"
        
    def _build_analysis_prompt(self, metadata: Optional[Dict] = None) -> str:
        """构建分析提示词"""
        equipment_section = ""
        if metadata:
            equipment_section = f"""
Equipment Information:
- Machine ID: {metadata.get('machine_id', 'Unknown')}
- Part ID: {metadata.get('part_id', 'Unknown')}
- Process: {metadata.get('process_id', 'Unknown')} (Step {metadata.get('process_number', 0)})

"""
        
        return f"""
{equipment_section}Analyze this industrial operation video and extract the following information:

1. Detailed operation steps (in chronological order)
   - Include precise timestamps for each step (MM:SS format)
   - Describe hand movements and tool usage
   - Note any quality checkpoints

2. Key quality inspection points and inspection methods
   - Visual inspection requirements
   - Measurement procedures
   - Acceptance criteria

3. Safety precautions
   - PPE requirements observed
   - Hazard identification
   - Safety protocols followed

4. Tool and material usage
   - List of tools used
   - Material specifications
   - Handling procedures

5. Potential risk points
   - Safety hazards identified
   - Quality risks
   - Process deviations

6. Operation standards and requirements
   - Time standards observed
   - Quality standards
   - Performance metrics

Output Requirements:
- Format: Valid JSON only
- Include timestamps in MM:SS format
- Provide confidence scores where applicable
- Structure as follows:

{{
  "operation_steps": [
    {{
      "step_number": 1,
      "timestamp": "00:15",
      "description": "detailed description",
      "tools_used": ["tool1", "tool2"],
      "safety_notes": "safety observations",
      "quality_checkpoint": true/false
    }}
  ],
  "quality_points": [
    {{
      "checkpoint_id": 1,
      "timestamp": "01:30",
      "description": "inspection description",
      "method": "inspection method",
      "criteria": "acceptance criteria"
    }}
  ],
  "safety_requirements": [
    {{
      "requirement": "PPE requirement",
      "timestamp": "00:05",
      "compliance_observed": true/false
    }}
  ],
  "tools_and_materials": [
    {{
      "item": "tool/material name",
      "usage_timestamp": "02:15",
      "purpose": "usage purpose"
    }}
  ],
  "risk_assessment": [
    {{
      "risk_type": "safety/quality",
      "description": "risk description",
      "severity": "low/medium/high",
      "timestamp": "03:00"
    }}
  ]
}}
"""
    
    def analyze_video(self, video_file, metadata: Optional[Dict] = None) -> Dict[str, Any]:
        """分析视频并返回结构化结果"""
        prompt = self._build_analysis_prompt(metadata)
        
        # 配置参数
        config = {
            "temperature": 0.1,
            "max_output_tokens": 8192,
            "response_mime_type": "application/json"
        }
        
        try:
            response = self.client.models.generate_content(
                model=self.model,
                contents=[video_file, prompt],
                config=config
            )
            
            # 尝试解析JSON
            try:
                result = json.loads(response.text)
                return {
                    "success": True,
                    "data": result,
                    "raw_response": response.text
                }
            except json.JSONDecodeError:
                return {
                    "success": False,
                    "error": "Failed to parse JSON response",
                    "raw_response": response.text
                }
                
        except Exception as e:
            return {
                "success": False,
                "error": str(e),
                "raw_response": None
            }

# 使用示例
analyzer = GeminiVideoAnalyzer(api_key="your_api_key")

metadata = {
    'machine_id': 'M001',
    'part_id': 'P001',
    'process_id': 'PROC001',
    'process_number': 1
}

result = analyzer.analyze_video(myfile, metadata)

if result["success"]:
    print("分析成功！")
    print(json.dumps(result["data"], indent=2, ensure_ascii=False))
else:
    print(f"分析失败: {result['error']}")
    print(f"原始响应: {result['raw_response']}")
```

### **方法4: 错误处理增强版**

```python
def analyze_video_with_retry(video_file, metadata=None, max_retries=3):
    """带重试机制的视频分析"""
    
    for attempt in range(max_retries):
        try:
            # 创建客户端
            client = genai.Client(api_key="your_api_key")
            
            # 构建提示词
            prompt = """
            Analyze this industrial operation video and provide a structured JSON response with:
            1. Operation steps with timestamps
            2. Quality checkpoints  
            3. Safety observations
            4. Tools and materials used
            5. Risk assessment
            
            Format: Valid JSON only, timestamps in MM:SS format
            """
            
            # 发送请求
            response = client.models.generate_content(
                model="gemini-2.0-flash",
                contents=[video_file, prompt],
                config={
                    "temperature": 0.1,
                    "max_output_tokens": 8192
                }
            )
            
            # 验证响应
            if response and response.text:
                try:
                    # 尝试解析JSON
                    result = json.loads(response.text)
                    return {"success": True, "data": result}
                except json.JSONDecodeError:
                    # 如果不是有效JSON，返回原始文本
                    return {"success": False, "raw_text": response.text}
            
        except Exception as e:
            print(f"Attempt {attempt + 1} failed: {e}")
            if attempt == max_retries - 1:
                return {"success": False, "error": str(e)}
            
    return {"success": False, "error": "Max retries exceeded"}

# 使用
result = analyze_video_with_retry(myfile)
print(result)
```

## **关键修正点**

1. **移除了不支持的配置项**：如 `system`、`parts` 等
2. **简化了contents格式**：直接使用列表 `[video_file, prompt_text]`
3. **修正了config参数**：只保留支持的配置项
4. **添加了错误处理**：处理JSON解析失败等情况
5. **使用了正确的API调用方式**

选择**方法1**最简单直接，**方法3**最完整专业。根据你的需求选择合适的方案。
